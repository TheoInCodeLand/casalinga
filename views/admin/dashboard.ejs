<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Casalinga Tours</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --popover: 0 0% 100%;
      --popover-foreground: 222.2 84% 4.9%;
      --primary: 221.2 83.2% 53.3%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96%;
      --secondary-foreground: 222.2 84% 4.9%;
      --muted: 210 40% 96%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96%;
      --accent-foreground: 222.2 84% 4.9%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 221.2 83.2% 53.3%;
      --radius: 0.75rem;
      --sidebar-background: 0 0% 98%;
      --sidebar-foreground: 240 5.3% 26.1%;
      --sidebar-primary: 240 5.9% 10%;
      --sidebar-primary-foreground: 0 0% 98%;
      --sidebar-accent: 240 4.8% 95.9%;
      --sidebar-accent-foreground: 240 5.9% 10%;
      --sidebar-border: 220 13% 91%;
      --sidebar-ring: 217.2 91.2% 59.8%;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    /* Layout */
    .app-wrapper {
      display: flex;
      min-height: 100vh;
      width: 100%;
    }

    /* Sidebar */
    .sidebar {
      width: 16rem;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      background-color: hsl(var(--sidebar-background));
      border-right: 1px solid hsl(var(--border));
      display: flex;
      flex-direction: column;
      z-index: 40;
      transition: transform 0.2s ease-in-out;
    }

    .sidebar-header {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .sidebar-logo-icon {
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
    }

    .sidebar-logo-icon svg {
      width: 1rem;
      height: 1rem;
    }

    .sidebar-logo-text {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 0.5rem;
    }

    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      list-style: none;
    }

    .sidebar-menu-item {
      position: relative;
    }

    .sidebar-menu-button {
      display: flex;
      width: 100%;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      text-decoration: none;
      color: hsl(var(--sidebar-foreground));
      background: transparent;
      border: none;
      cursor: pointer;
      transition: background-color 0.15s, color 0.15s;
    }

    .sidebar-menu-button:hover {
      background-color: hsl(var(--sidebar-accent));
      color: hsl(var(--sidebar-accent-foreground));
    }

    .sidebar-menu-button.active {
      background-color: hsl(var(--sidebar-accent));
      color: hsl(var(--sidebar-accent-foreground));
      font-weight: 500;
    }

    .sidebar-menu-button svg {
      width: 1rem;
      height: 1rem;
      flex-shrink: 0;
    }

    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid hsl(var(--border));
    }

    .sidebar-user {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-user-avatar {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      object-fit: cover;
    }

    .sidebar-user-info {
      display: flex;
      flex-direction: column;
    }

    .sidebar-user-name {
      font-size: 0.875rem;
      font-weight: 500;
    }

    .sidebar-user-role {
      font-size: 0.75rem;
      color: hsl(var(--muted-foreground));
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 16rem;
      overflow-x: hidden;
    }

    /* Topbar */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem;
      border-bottom: 1px solid hsl(var(--border));
      background-color: hsl(var(--background));
    }

    .topbar-search {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
      max-width: 28rem;
    }

    .search-input-wrapper {
      position: relative;
      flex: 1;
    }

    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: hsl(var(--muted-foreground));
      width: 1rem;
      height: 1rem;
    }

    .search-input {
      width: 100%;
      height: 2.5rem;
      padding: 0.5rem 0.75rem 0.5rem 2.5rem;
      font-size: 0.875rem;
      border: 1px solid hsl(var(--input));
      border-radius: var(--radius);
      background-color: transparent;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .search-input:focus {
      border-color: hsl(var(--ring));
      box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
    }

    .search-input::placeholder {
      color: hsl(var(--muted-foreground));
    }

    .topbar-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .icon-button {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 0.375rem;
      background: transparent;
      border: none;
      cursor: pointer;
      color: hsl(var(--foreground));
      transition: background-color 0.15s;
    }

    .icon-button:hover {
      background-color: hsl(var(--accent));
    }

    .icon-button svg {
      width: 1rem;
      height: 1rem;
    }

    .notification-badge {
      position: absolute;
      top: -0.25rem;
      right: -0.25rem;
      width: 1.25rem;
      height: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 500;
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border-radius: 50%;
    }

    .avatar-button {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      overflow: hidden;
      cursor: pointer;
      border: none;
      padding: 0;
    }

    .avatar-button img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Page Content */
    .page-content {
      flex: 1;
      padding: 1.5rem 2rem 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .page-title {
      font-size: 1.875rem;
      font-weight: 700;
      letter-spacing: -0.025em;
    }

    .page-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Button */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background-color 0.15s, color 0.15s, border-color 0.15s;
      white-space: nowrap;
      text-decoration: none;
    }

    .btn svg {
      width: 1rem;
      height: 1rem;
    }

    .btn-primary {
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border: none;
    }

    .btn-primary:hover {
      background-color: hsl(221.2 83.2% 46%);
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid hsl(var(--input));
      color: hsl(var(--foreground));
    }

    .btn-outline:hover {
      background-color: hsl(var(--accent));
    }

    .btn-sm {
      height: 2rem;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
    }

    .btn-ghost {
      background: transparent;
      border: none;
      color: hsl(var(--foreground));
    }

    .btn-ghost:hover {
      background-color: hsl(var(--accent));
    }

    /* Date Range Picker */
    .date-picker-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem 0.75rem;
      font-size: 0.875rem;
      font-weight: 400;
      border: 1px solid hsl(var(--input));
      border-radius: var(--radius);
      background: transparent;
      color: hsl(var(--foreground));
      cursor: pointer;
      min-width: 16.25rem;
      justify-content: flex-start;
      text-align: left;
    }

    .date-picker-btn:hover {
      background-color: hsl(var(--accent));
    }

    .date-picker-btn svg {
      width: 1rem;
      height: 1rem;
      color: hsl(var(--muted-foreground));
    }

    /* Tabs */
    .tabs {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .tabs-list {
      display: inline-flex;
      height: 2.5rem;
      align-items: center;
      justify-content: flex-start;
      border-radius: var(--radius);
      background-color: hsl(var(--muted));
      padding: 0.25rem;
      gap: 0.25rem;
    }

    .tab-trigger {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.375rem 0.75rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: calc(var(--radius) - 2px);
      background: transparent;
      border: none;
      color: hsl(var(--muted-foreground));
      cursor: pointer;
      transition: background-color 0.15s, color 0.15s;
      white-space: nowrap;
    }

    .tab-trigger:hover {
      color: hsl(var(--foreground));
    }

    .tab-trigger.active {
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Cards */
    .card {
      border-radius: var(--radius);
      border: 1px solid hsl(var(--border));
      background-color: hsl(var(--card));
      color: hsl(var(--card-foreground));
    }

    .card-header {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
      padding: 1.5rem;
    }

    .card-header-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 0.5rem;
    }

    .card-title {
      font-size: 0.875rem;
      font-weight: 500;
      line-height: 1;
    }

    .card-title-lg {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .card-description {
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
    }

    .card-content {
      padding: 0 1.5rem 1.5rem;
    }

    .card-icon {
      width: 1rem;
      height: 1rem;
      color: hsl(var(--muted-foreground));
    }

    .card-value {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .card-subtitle {
      font-size: 0.75rem;
      color: hsl(var(--muted-foreground));
    }

    /* Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1rem;
    }

    .col-span-4 {
      grid-column: span 4;
    }

    .col-span-3 {
      grid-column: span 3;
    }

    /* Chart Container */
    .chart-container {
      height: 350px;
      padding-left: 0.5rem;
    }

    /* Recent Sales/Bookings */
    .recent-sales {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .sale-item {
      display: flex;
      align-items: center;
      border-bottom: 1px solid hsl(var(--border));
      padding-bottom: 1rem;
    }
    
    .sale-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .sale-avatar {
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 50%;
      object-fit: cover;
      background-color: hsl(var(--muted));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: hsl(var(--muted-foreground));
    }

    .sale-info {
      margin-left: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .sale-name {
      font-size: 0.875rem;
      font-weight: 500;
      line-height: 1;
    }

    .sale-company {
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
    }

    .sale-amount {
      margin-left: auto;
      font-weight: 500;
    }

    /* Status Badge */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .badge-success { background-color: #d1fae5; color: #065f46; }
    .badge-warning { background-color: #fef3c7; color: #92400e; }
    .badge-danger { background-color: #fee2e2; color: #991b1b; }
    .badge-info { background-color: #dbeafe; color: #1e40af; }

    /* Placeholder Content */
    .placeholder-content {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: hsl(var(--muted-foreground));
    }

    /* Dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: calc(100% + 0.5rem);
      min-width: 12rem;
      background-color: hsl(var(--popover));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
      z-index: 50;
      padding: 0.25rem;
      animation: slideIn 0.15s ease-out;
    }

    .dropdown-content.show {
      display: block;
    }

    .dropdown-content.wide {
      min-width: 20rem;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-0.5rem);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dropdown-label {
      padding: 0.5rem 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .dropdown-separator {
      height: 1px;
      background-color: hsl(var(--border));
      margin: 0.25rem 0;
    }

    .dropdown-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      width: 100%;
      padding: 0.5rem;
      font-size: 0.875rem;
      text-align: left;
      background: none;
      border: none;
      cursor: pointer;
      border-radius: calc(var(--radius) - 4px);
      color: hsl(var(--foreground));
      text-decoration: none;
    }

    .dropdown-item:hover {
      background-color: hsl(var(--accent));
    }

    .dropdown-item-title {
      font-weight: 500;
    }

    .dropdown-item-desc {
      font-size: 0.75rem;
      color: hsl(var(--muted-foreground));
    }

    /* Mobile Toggle */
    .mobile-toggle {
      display: none;
      align-items: center;
      justify-content: center;
      width: 2.5rem;
      height: 2.5rem;
      background: transparent;
      border: none;
      cursor: pointer;
      color: hsl(var(--foreground));
    }

    .mobile-toggle svg {
      width: 1.25rem;
      height: 1.25rem;
    }

    /* Sidebar Overlay */
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 35;
    }

    .sidebar-overlay.show {
      display: block;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }

      .col-span-4,
      .col-span-3 {
        grid-column: span 1;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-toggle {
        display: flex;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .page-actions {
        flex-wrap: wrap;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .topbar-search {
        display: none;
      }

      .date-picker-btn {
        min-width: auto;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <div class="app-wrapper">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
          </div>
          <span class="sidebar-logo-text">Casalinga Admin</span>
        </div>
      </div>
      <nav class="sidebar-content">
        <ul class="sidebar-menu">
          <li class="sidebar-menu-item">
            <a href="/admin/dashboard" class="sidebar-menu-button active">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="/admin/bookings" class="sidebar-menu-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>
              <span>Bookings</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="/admin/tours" class="sidebar-menu-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon></svg>
              <span>Tours</span>
            </a>
          </li>
          <% if (user.role === 'admin') { %>
          <li class="sidebar-menu-item">
            <a href="/admin/users" class="sidebar-menu-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
              <span>Users</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a href="/admin/analytics" class="sidebar-menu-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" x2="18" y1="20" y2="10"></line><line x1="12" x2="12" y1="20" y2="4"></line><line x1="6" x2="6" y1="20" y2="14"></line></svg>
              <span>Analytics</span>
            </a>
          </li>
          <% } %>
          <li class="sidebar-menu-item">
            <a href="/admin/settings/categories" class="sidebar-menu-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
              <span>Settings</span>
            </a>
          </li>
        </ul>
      </nav>
      <div class="sidebar-footer">
        <div class="sidebar-user">
          <img class="sidebar-user-avatar" src="<%= user.avatar || '/images/default-avatar.png' %>" alt="<%= user.name %>">
          <div class="sidebar-user-info">
            <span class="sidebar-user-name"><%= user.name %></span>
            <span class="sidebar-user-role"><%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %></span>
          </div>
        </div>
      </div>
    </aside>

    <main class="main-content">
      <header class="topbar">
        <div class="topbar-search">
          <button class="mobile-toggle" id="mobileToggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path></svg>
          </button>
          <form action="/admin/bookings" method="GET" class="search-input-wrapper">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
            <input type="text" name="search" class="search-input" placeholder="Search bookings...">
          </form>
        </div>

        <div class="topbar-actions">
          <div class="dropdown">
            <button class="icon-button" id="notificationBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path></svg>
              <% if (bookings.pending > 0) { %>
              <span class="notification-badge"><%= bookings.pending %></span>
              <% } %>
            </button>
            <div class="dropdown-content wide" id="notificationDropdown">
              <div class="dropdown-label">Notifications</div>
              <div class="dropdown-separator"></div>
              <% if (bookings.pending > 0) { %>
              <a href="/admin/bookings?status=pending" class="dropdown-item">
                <span class="dropdown-item-title">Pending Bookings</span>
                <span class="dropdown-item-desc">You have <%= bookings.pending %> bookings to review</span>
              </a>
              <% } else { %>
              <div class="dropdown-item">
                <span class="dropdown-item-desc">No new notifications</span>
              </div>
              <% } %>
            </div>
          </div>

          <div class="dropdown">
            <button class="avatar-button" id="userBtn">
              <img src="<%= user.avatar || '/images/default-avatar.png' %>" alt="<%= user.name %>">
            </button>
            <div class="dropdown-content" id="userDropdown">
              <div class="dropdown-label">My Account</div>
              <div class="dropdown-separator"></div>
              <a href="/user/profile" class="dropdown-item">Profile</a>
              <a href="/user/settings" class="dropdown-item">Settings</a>
              <div class="dropdown-separator"></div>
              <a href="/auth/logout" class="dropdown-item" style="color: var(--destructive);">Log out</a>
            </div>
          </div>
        </div>
      </header>

      <div class="page-content">
        <div class="page-header">
          <h2 class="page-title">Dashboard Overview</h2>
          <div class="page-actions">
            <div class="dropdown">
              <button class="date-picker-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>
                <span><%= moment().format('MMM D, YYYY') %></span>
              </button>
            </div>
            <a href="/admin/tours/create" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
              Add New Tour
            </a>
          </div>
        </div>

        <div class="tabs">
          <div class="tabs-list">
            <button class="tab-trigger active" data-tab="overview">Overview</button>
            <button class="tab-trigger" data-tab="bookings">Recent Bookings</button>
            <button class="tab-trigger" data-tab="tours">Popular Tours</button>
          </div>

          <div class="tab-content active" id="tab-overview">
            <div class="stats-grid">
              <div class="card">
                <div class="card-header card-header-row">
                  <h3 class="card-title">Total Revenue</h3>
                  <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                </div>
                <div class="card-content">
                  <div class="card-value">R<%= revenue.total.toLocaleString() %></div>
                  <p class="card-subtitle <%= revenue.trend >= 0 ? 'text-success' : 'text-danger' %>">
                    <%= revenue.trend >= 0 ? '+' : '' %><%= revenue.trend %>% vs last month
                  </p>
                </div>
              </div>
              
              <div class="card">
                <div class="card-header card-header-row">
                  <h3 class="card-title">New Bookings</h3>
                  <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>
                </div>
                <div class="card-content">
                  <div class="card-value"><%= bookings.total %></div>
                  <p class="card-subtitle"><%= bookings.pending %> Pending approval <a href="/admin/bookings" style="text-decoration: none;">(View)</a></p>
                </div>
              </div>

              <div class="card">
                <div class="card-header card-header-row">
                  <h3 class="card-title">Active Tours</h3>
                  <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon></svg>
                </div>
                <div class="card-content">
                  <div class="card-value"><%= tours.available %></div>
                  <p class="card-subtitle"><%= tours.upcoming %> Upcoming tours</p>
                </div>
              </div>

              <div class="card">
                <div class="card-header card-header-row">
                  <h3 class="card-title">Total Users</h3>
                  <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </div>
                <div class="card-content">
                  <div class="card-value"><%= users.total %></div>
                  <p class="card-subtitle"><%= users.new_this_month %> New this month</p>
                </div>
              </div>
            </div>

            <div class="charts-grid">
              <div class="card col-span-4">
                <div class="card-header">
                  <h3 class="card-title card-title-lg">Recent Bookings</h3>
                  <p class="card-description">Latest tour reservations</p>
                </div>
                <div class="card-content">
                  <div class="recent-sales">
                    <% recentBookings.forEach(booking => { %>
                    <div class="sale-item">
                      <div class="sale-avatar">
                        <%= booking.user_name.charAt(0).toUpperCase() %>
                      </div>
                      <div class="sale-info">
                        <p class="sale-name"><%= booking.tour_title %></p>
                        <p class="sale-company"><%= booking.user_name %> â€¢ #<%= booking.booking_number.split('-').pop() %></p>
                      </div>
                      <div class="sale-amount">
                        <div class="d-flex flex-column align-items-end">
                          <span>R<%= parseFloat(booking.total_price).toLocaleString() %></span>
                          <span class="badge badge-<%= booking.status === 'confirmed' ? 'success' : (booking.status === 'pending' ? 'warning' : 'danger') %>">
                            <%= booking.status.toUpperCase() %>
                          </span>
                        </div>
                      </div>
                    </div>
                    <% }) %>
                  </div>
                </div>
              </div>
              
              <div class="card col-span-3">
                <div class="card-header">
                  <h3 class="card-title card-title-lg">Popular Tours</h3>
                  <p class="card-description">Highest performing packages</p>
                </div>
                <div class="card-content">
                  <div class="recent-sales">
                    <% popularTours.forEach(tour => { %>
                    <div class="sale-item">
                      <div class="sale-info" style="margin-left: 0;">
                        <p class="sale-name"><%= tour.title %></p>
                        <p class="sale-company"><%= tour.bookings_count %> total bookings</p>
                      </div>
                      <span class="sale-amount text-success">R<%= parseFloat(tour.revenue).toLocaleString() %></span>
                    </div>
                    <% }) %>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="tab-bookings">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title card-title-lg">All Recent Bookings</h3>
                <a href="/admin/bookings" class="card-description text-primary">View Full Booking Management &rarr;</a>
              </div>
              <div class="card-content">
                <div class="recent-sales">
                  <% recentBookings.forEach(booking => { %>
                  <div class="sale-item">
                    <div class="sale-info" style="margin-left: 0;">
                      <p class="sale-name">Booking #<%= booking.booking_number %></p>
                      <p class="sale-company"><%= moment(booking.booked_at).format('MMM D, YYYY') %></p>
                    </div>
                    <span class="sale-amount">R<%= parseFloat(booking.total_price).toLocaleString() %></span>
                  </div>
                  <% }) %>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="tab-tours">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title card-title-lg">Top Performing Tours</h3>
                <a href="/admin/analytics/popular-tours" class="card-description text-primary">View Full Report &rarr;</a>
              </div>
              <div class="card-content">
                <div class="recent-sales">
                  <% popularTours.forEach(tour => { %>
                  <div class="sale-item">
                    <div class="sale-info" style="margin-left: 0;">
                      <p class="sale-name"><%= tour.title %></p>
                    </div>
                    <span class="sale-amount"><%= tour.bookings_count %> Bookings</span>
                  </div>
                  <% }) %>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </main>
  </div>

  <script>
    // Mobile Sidebar Toggle
    const mobileToggle = document.getElementById('mobileToggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');

    if (mobileToggle) {
      mobileToggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        sidebarOverlay.classList.toggle('show');
      });
    }

    if (sidebarOverlay) {
      sidebarOverlay.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('show');
      });
    }

    // Dropdown Toggles
    function setupDropdown(buttonId, dropdownId) {
      const button = document.getElementById(buttonId);
      const dropdown = document.getElementById(dropdownId);

      if (button && dropdown) {
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          // Close all other dropdowns
          document.querySelectorAll('.dropdown-content.show').forEach(el => {
            if (el.id !== dropdownId) el.classList.remove('show');
          });
          dropdown.classList.toggle('show');
        });
      }
    }

    setupDropdown('notificationBtn', 'notificationDropdown');
    setupDropdown('userBtn', 'userDropdown');

    // Close dropdowns when clicking outside
    document.addEventListener('click', () => {
      document.querySelectorAll('.dropdown-content.show').forEach(el => {
        el.classList.remove('show');
      });
    });

    // Prevent dropdown from closing when clicking inside
    document.querySelectorAll('.dropdown-content').forEach(el => {
      el.addEventListener('click', (e) => e.stopPropagation());
    });

    // Tabs
    const tabTriggers = document.querySelectorAll('.tab-trigger');
    const tabContents = document.querySelectorAll('.tab-content');

    tabTriggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        const targetTab = trigger.dataset.tab;

        // Update active state on triggers
        tabTriggers.forEach(t => t.classList.remove('active'));
        trigger.classList.add('active');

        // Update active state on content
        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === `tab-${targetTab}`) {
            content.classList.add('active');
          }
        });
      });
    });

    // Sidebar menu active state
    const currentPath = window.location.pathname;
    const menuButtons = document.querySelectorAll('.sidebar-menu-button');
    menuButtons.forEach(button => {
      if (button.getAttribute('href') === currentPath) {
        button.classList.add('active');
      } else {
        button.classList.remove('active');
      }
    });

    // Keyboard shortcut for sidebar toggle (Ctrl/Cmd + B)
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'b') {
        e.preventDefault();
        sidebar.classList.toggle('open');
        if (sidebarOverlay) sidebarOverlay.classList.toggle('show');
      }
    });
  </script>
</body>
</html>